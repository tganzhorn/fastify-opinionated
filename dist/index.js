var Ne=Object.create;var fe=Object.defineProperty;var Be=Object.getOwnPropertyDescriptor;var Ue=Object.getOwnPropertyNames;var We=Object.getPrototypeOf,Ve=Object.prototype.hasOwnProperty;var Xe=(i,a)=>()=>(a||i((a={exports:{}}).exports,a),a.exports);var Ye=(i,a,c,y)=>{if(a&&typeof a=="object"||typeof a=="function")for(let m of Ue(a))!Ve.call(i,m)&&m!==c&&fe(i,m,{get:()=>a[m],enumerable:!(y=Be(a,m))||y.enumerable});return i};var Qe=(i,a,c)=>(c=i!=null?Ne(We(i)):{},Ye(a||!i||!i.__esModule?fe(c,"default",{value:i,enumerable:!0}):c,i));var le=Xe(()=>{"use strict";var ce;(function(i){(function(a){var c=typeof globalThis=="object"?globalThis:typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:g(),y=m(i);typeof c.Reflect<"u"&&(y=m(c.Reflect,y)),a(y,c),typeof c.Reflect>"u"&&(c.Reflect=i);function m(P,R){return function(k,C){Object.defineProperty(P,k,{configurable:!0,writable:!0,value:C}),R&&R(k,C)}}function O(){try{return Function("return this;")()}catch{}}function v(){try{return(0,eval)("(function() { return this; })()")}catch{}}function g(){return O()||v()}})(function(a,c){var y=Object.prototype.hasOwnProperty,m=typeof Symbol=="function",O=m&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",v=m&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",g=typeof Object.create=="function",P={__proto__:[]}instanceof Array,R=!g&&!P,k={create:g?function(){return W(Object.create(null))}:P?function(){return W({__proto__:null})}:function(){return W({})},has:R?function(e,t){return y.call(e,t)}:function(e,t){return t in e},get:R?function(e,t){return y.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},C=Object.getPrototypeOf(Function),T=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:$e(),G=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Ae(),H=typeof WeakMap=="function"?WeakMap:Le(),I=m?Symbol.for("@reflect-metadata:registry"):void 0,A=je(),V=qe(A);function ve(e,t,r,n){if(d(r)){if(!te(e))throw new TypeError;if(!re(t))throw new TypeError;return Oe(e,t)}else{if(!te(e))throw new TypeError;if(!M(t))throw new TypeError;if(!M(n)&&!d(n)&&!D(n))throw new TypeError;return D(n)&&(n=void 0),r=E(r),Re(e,t,r,n)}}a("decorate",ve);function me(e,t){function r(n,l){if(!M(n))throw new TypeError;if(!d(l)&&!Ie(l))throw new TypeError;z(e,t,n,l)}return r}a("metadata",me);function we(e,t,r,n){if(!M(r))throw new TypeError;return d(n)||(n=E(n)),z(e,t,r,n)}a("defineMetadata",we);function Me(e,t,r){if(!M(t))throw new TypeError;return d(r)||(r=E(r)),X(e,t,r)}a("hasMetadata",Me);function _e(e,t,r){if(!M(t))throw new TypeError;return d(r)||(r=E(r)),N(e,t,r)}a("hasOwnMetadata",_e);function be(e,t,r){if(!M(t))throw new TypeError;return d(r)||(r=E(r)),Y(e,t,r)}a("getMetadata",be);function ge(e,t,r){if(!M(t))throw new TypeError;return d(r)||(r=E(r)),Q(e,t,r)}a("getOwnMetadata",ge);function xe(e,t){if(!M(e))throw new TypeError;return d(t)||(t=E(t)),J(e,t)}a("getMetadataKeys",xe);function Pe(e,t){if(!M(e))throw new TypeError;return d(t)||(t=E(t)),Z(e,t)}a("getOwnMetadataKeys",Pe);function Ce(e,t,r){if(!M(t))throw new TypeError;if(d(r)||(r=E(r)),!M(t))throw new TypeError;d(r)||(r=E(r));var n=$(t,r,!1);return d(n)?!1:n.OrdinaryDeleteMetadata(e,t,r)}a("deleteMetadata",Ce);function Oe(e,t){for(var r=e.length-1;r>=0;--r){var n=e[r],l=n(t);if(!d(l)&&!D(l)){if(!re(l))throw new TypeError;t=l}}return t}function Re(e,t,r,n){for(var l=e.length-1;l>=0;--l){var _=e[l],x=_(t,r,n);if(!d(x)&&!D(x)){if(!M(x))throw new TypeError;n=x}}return n}function X(e,t,r){var n=N(e,t,r);if(n)return!0;var l=U(t);return D(l)?!1:X(e,l,r)}function N(e,t,r){var n=$(t,r,!1);return d(n)?!1:ee(n.OrdinaryHasOwnMetadata(e,t,r))}function Y(e,t,r){var n=N(e,t,r);if(n)return Q(e,t,r);var l=U(t);if(!D(l))return Y(e,l,r)}function Q(e,t,r){var n=$(t,r,!1);if(!d(n))return n.OrdinaryGetOwnMetadata(e,t,r)}function z(e,t,r,n){var l=$(r,n,!0);l.OrdinaryDefineOwnMetadata(e,t,r,n)}function J(e,t){var r=Z(e,t),n=U(e);if(n===null)return r;var l=J(n,t);if(l.length<=0)return r;if(r.length<=0)return l;for(var _=new G,x=[],p=0,o=r;p<o.length;p++){var s=o[p],u=_.has(s);u||(_.add(s),x.push(s))}for(var f=0,h=l;f<h.length;f++){var s=h[f],u=_.has(s);u||(_.add(s),x.push(s))}return x}function Z(e,t){var r=$(e,t,!1);return r?r.OrdinaryOwnMetadataKeys(e,t):[]}function K(e){if(e===null)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return e===null?1:6;default:return 6}}function d(e){return e===void 0}function D(e){return e===null}function Te(e){return typeof e=="symbol"}function M(e){return typeof e=="object"?e!==null:typeof e=="function"}function ke(e,t){switch(K(e)){case 0:return e;case 1:return e;case 2:return e;case 3:return e;case 4:return e;case 5:return e}var r=t===3?"string":t===5?"number":"default",n=ne(e,O);if(n!==void 0){var l=n.call(e,r);if(M(l))throw new TypeError;return l}return Se(e,r==="default"?"number":r)}function Se(e,t){if(t==="string"){var r=e.toString;if(j(r)){var n=r.call(e);if(!M(n))return n}var l=e.valueOf;if(j(l)){var n=l.call(e);if(!M(n))return n}}else{var l=e.valueOf;if(j(l)){var n=l.call(e);if(!M(n))return n}var _=e.toString;if(j(_)){var n=_.call(e);if(!M(n))return n}}throw new TypeError}function ee(e){return!!e}function Ee(e){return""+e}function E(e){var t=ke(e,3);return Te(t)?t:Ee(t)}function te(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:Object.prototype.toString.call(e)==="[object Array]"}function j(e){return typeof e=="function"}function re(e){return typeof e=="function"}function Ie(e){switch(K(e)){case 3:return!0;case 4:return!0;default:return!1}}function B(e,t){return e===t||e!==e&&t!==t}function ne(e,t){var r=e[t];if(r!=null){if(!j(r))throw new TypeError;return r}}function ae(e){var t=ne(e,v);if(!j(t))throw new TypeError;var r=t.call(e);if(!M(r))throw new TypeError;return r}function oe(e){return e.value}function ie(e){var t=e.next();return t.done?!1:t}function se(e){var t=e.return;t&&t.call(e)}function U(e){var t=Object.getPrototypeOf(e);if(typeof e!="function"||e===C||t!==C)return t;var r=e.prototype,n=r&&Object.getPrototypeOf(r);if(n==null||n===Object.prototype)return t;var l=n.constructor;return typeof l!="function"||l===e?t:l}function De(){var e;!d(I)&&typeof c.Reflect<"u"&&!(I in c.Reflect)&&typeof c.Reflect.defineMetadata=="function"&&(e=Fe(c.Reflect));var t,r,n,l=new H,_={registerProvider:x,getProvider:o,setProvider:u};return _;function x(f){if(!Object.isExtensible(_))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===f:break;case d(t):t=f;break;case t===f:break;case d(r):r=f;break;case r===f:break;default:n===void 0&&(n=new G),n.add(f);break}}function p(f,h){if(!d(t)){if(t.isProviderFor(f,h))return t;if(!d(r)){if(r.isProviderFor(f,h))return t;if(!d(n))for(var w=ae(n);;){var b=ie(w);if(!b)return;var S=oe(b);if(S.isProviderFor(f,h))return se(w),S}}}if(!d(e)&&e.isProviderFor(f,h))return e}function o(f,h){var w=l.get(f),b;return d(w)||(b=w.get(h)),d(b)&&(b=p(f,h),d(b)||(d(w)&&(w=new T,l.set(f,w)),w.set(h,b))),b}function s(f){if(d(f))throw new TypeError;return t===f||r===f||!d(n)&&n.has(f)}function u(f,h,w){if(!s(w))throw new Error("Metadata provider not registered.");var b=o(f,h);if(b!==w){if(!d(b))return!1;var S=l.get(f);d(S)&&(S=new T,l.set(f,S)),S.set(h,w)}return!0}}function je(){var e;return!d(I)&&M(c.Reflect)&&Object.isExtensible(c.Reflect)&&(e=c.Reflect[I]),d(e)&&(e=De()),!d(I)&&M(c.Reflect)&&Object.isExtensible(c.Reflect)&&Object.defineProperty(c.Reflect,I,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function qe(e){var t=new H,r={isProviderFor:function(s,u){var f=t.get(s);return d(f)?!1:f.has(u)},OrdinaryDefineOwnMetadata:x,OrdinaryHasOwnMetadata:l,OrdinaryGetOwnMetadata:_,OrdinaryOwnMetadataKeys:p,OrdinaryDeleteMetadata:o};return A.registerProvider(r),r;function n(s,u,f){var h=t.get(s),w=!1;if(d(h)){if(!f)return;h=new T,t.set(s,h),w=!0}var b=h.get(u);if(d(b)){if(!f)return;if(b=new T,h.set(u,b),!e.setProvider(s,u,r))throw h.delete(u),w&&t.delete(s),new Error("Wrong provider for target.")}return b}function l(s,u,f){var h=n(u,f,!1);return d(h)?!1:ee(h.has(s))}function _(s,u,f){var h=n(u,f,!1);if(!d(h))return h.get(s)}function x(s,u,f,h){var w=n(f,h,!0);w.set(s,u)}function p(s,u){var f=[],h=n(s,u,!1);if(d(h))return f;for(var w=h.keys(),b=ae(w),S=0;;){var ue=ie(b);if(!ue)return f.length=S,f;var Ge=oe(ue);try{f[S]=Ge}catch(He){try{se(b)}finally{throw He}}S++}}function o(s,u,f){var h=n(u,f,!1);if(d(h)||!h.delete(s))return!1;if(h.size===0){var w=t.get(u);d(w)||(w.delete(f),w.size===0&&t.delete(w))}return!0}}function Fe(e){var t=e.defineMetadata,r=e.hasOwnMetadata,n=e.getOwnMetadata,l=e.getOwnMetadataKeys,_=e.deleteMetadata,x=new H,p={isProviderFor:function(o,s){var u=x.get(o);return!d(u)&&u.has(s)?!0:l(o,s).length?(d(u)&&(u=new G,x.set(o,u)),u.add(s),!0):!1},OrdinaryDefineOwnMetadata:t,OrdinaryHasOwnMetadata:r,OrdinaryGetOwnMetadata:n,OrdinaryOwnMetadataKeys:l,OrdinaryDeleteMetadata:_};return p}function $(e,t,r){var n=A.getProvider(e,t);if(!d(n))return n;if(r){if(A.setProvider(e,t,V))return V;throw new Error("Illegal state.")}}function $e(){var e={},t=[],r=function(){function p(o,s,u){this._index=0,this._keys=o,this._values=s,this._selector=u}return p.prototype["@@iterator"]=function(){return this},p.prototype[v]=function(){return this},p.prototype.next=function(){var o=this._index;if(o>=0&&o<this._keys.length){var s=this._selector(this._keys[o],this._values[o]);return o+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:s,done:!1}}return{value:void 0,done:!0}},p.prototype.throw=function(o){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),o},p.prototype.return=function(o){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:o,done:!0}},p}(),n=function(){function p(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(p.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),p.prototype.has=function(o){return this._find(o,!1)>=0},p.prototype.get=function(o){var s=this._find(o,!1);return s>=0?this._values[s]:void 0},p.prototype.set=function(o,s){var u=this._find(o,!0);return this._values[u]=s,this},p.prototype.delete=function(o){var s=this._find(o,!1);if(s>=0){for(var u=this._keys.length,f=s+1;f<u;f++)this._keys[f-1]=this._keys[f],this._values[f-1]=this._values[f];return this._keys.length--,this._values.length--,B(o,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},p.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},p.prototype.keys=function(){return new r(this._keys,this._values,l)},p.prototype.values=function(){return new r(this._keys,this._values,_)},p.prototype.entries=function(){return new r(this._keys,this._values,x)},p.prototype["@@iterator"]=function(){return this.entries()},p.prototype[v]=function(){return this.entries()},p.prototype._find=function(o,s){if(!B(this._cacheKey,o)){this._cacheIndex=-1;for(var u=0;u<this._keys.length;u++)if(B(this._keys[u],o)){this._cacheIndex=u;break}}return this._cacheIndex<0&&s&&(this._cacheIndex=this._keys.length,this._keys.push(o),this._values.push(void 0)),this._cacheIndex},p}();return n;function l(p,o){return p}function _(p,o){return o}function x(p,o){return[p,o]}}function Ae(){var e=function(){function t(){this._map=new T}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(r){return this._map.has(r)},t.prototype.add=function(r){return this._map.set(r,r),this},t.prototype.delete=function(r){return this._map.delete(r)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.keys()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[v]=function(){return this.keys()},t}();return e}function Le(){var e=16,t=k.create(),r=n();return function(){function o(){this._key=n()}return o.prototype.has=function(s){var u=l(s,!1);return u!==void 0?k.has(u,this._key):!1},o.prototype.get=function(s){var u=l(s,!1);return u!==void 0?k.get(u,this._key):void 0},o.prototype.set=function(s,u){var f=l(s,!0);return f[this._key]=u,this},o.prototype.delete=function(s){var u=l(s,!1);return u!==void 0?delete u[this._key]:!1},o.prototype.clear=function(){this._key=n()},o}();function n(){var o;do o="@@WeakMap@@"+p();while(k.has(t,o));return t[o]=!0,o}function l(o,s){if(!y.call(o,r)){if(!s)return;Object.defineProperty(o,r,{value:k.create()})}return o[r]}function _(o,s){for(var u=0;u<s;++u)o[u]=Math.random()*255|0;return o}function x(o){if(typeof Uint8Array=="function"){var s=new Uint8Array(o);return typeof crypto<"u"?crypto.getRandomValues(s):typeof msCrypto<"u"?msCrypto.getRandomValues(s):_(s,o),s}return _(new Array(o),o)}function p(){var o=x(e);o[6]=o[6]&79|64,o[8]=o[8]&191|128;for(var s="",u=0;u<e;++u){var f=o[u];(u===4||u===6||u===8)&&(s+="-"),f<16&&(s+="0"),s+=f.toString(16).toLowerCase()}return s}}function W(e){return e.__=void 0,delete e.__,e}})})(ce||(ce={}))});var Lt=Qe(le(),1);var q=Symbol.for("DEPS_CTX");var de="controller:path",ze="controller:config",L="route";function Je(i,a){return c=>{let y={deps:a};Reflect.defineMetadata(q,y,c);let m=Reflect.getMetadataKeys(c.prototype),O={rootPath:i,routerCtxs:new Map};for(let v of m)if(v.startsWith(de)){let g=v.split(":").slice(-1)[0];O.routerCtxs.set(g,Reflect.getMetadata(v,c.prototype))}for(let v of m)if(v.startsWith(L)&&v.startsWith(`${L}:schema`)){let g=v.split(":").slice(-1)[0];if(!O.routerCtxs.has(g)){console.warn(`${v} has no route registered!`);continue}O.routerCtxs.get(g).schema=Reflect.getMetadata(v,c.prototype)}Reflect.defineMetadata(ze,O,c.prototype)}}function F(i,a,c){return(y,m,O)=>{let v=O.value,g=[];for(let R of Reflect.getMetadataKeys(y)){let[k,C,T]=R.split(":");switch(k){case"req":g[T]={type:"req",methodName:C};break;case"rep":g[T]={type:"rep",methodName:C};break;case"query":g[T]={type:"query",name:Reflect.getMetadata(R,y),methodName:C};break;case"param":g[T]={type:"param",name:Reflect.getMetadata(R,y),methodName:C};break;case"body":g[T]={type:"body",methodName:C};break;case"headers":g[T]={type:"headers",methodName:C};break;case"raw":g[T]={type:"raw",methodName:C};break}}let P={path:i,method:a,propertyKey:m,call(...R){return v?.apply(this,R)},opts:c,params:g};Reflect.defineMetadata(`${de}:${m}`,P,y)}}function Ze(i,a){return F(i,"GET",a)}function Ke(i,a){return F(i,"POST",a)}function et(i,a){return F(i,"PUT",a)}function tt(i,a){return F(i,"DELETE",a)}function rt(i,a){return F(i,"PATCH",a)}function nt(i,a){return F(i,"ALL",a)}function at(){return(i,a,c)=>{Reflect.defineMetadata(`body:${String(a)}:${c}`,null,i)}}function ot(i){return(a,c,y)=>{Reflect.defineMetadata(`query:${String(c)}:${y}`,i,a)}}function it(i){return(a,c,y)=>{Reflect.defineMetadata(`param:${String(c)}:${y}`,i,a)}}function st(){return(i,a,c)=>{Reflect.defineMetadata(`req:${String(a)}:${c}`,null,i)}}function ut(){return(i,a,c)=>{Reflect.defineMetadata(`rep:${String(a)}:${c}`,"rep",i)}}function ft(){return(i,a,c)=>{Reflect.defineMetadata(`raw:${String(a)}:${c}`,"raw",i)}}function ct(){return(i,a,c)=>{Reflect.defineMetadata(`headers:${String(a)}:${c}`,"headers",i)}}function lt(i){return(a,c)=>{Reflect.defineMetadata(`${L}:schema:${String(c)}`,i,a)}}var dt=Symbol.for("INJECTABLE_SERVICE");function St(i){return a=>{let c={deps:i};Reflect.defineMetadata(q,c,a),Reflect.defineMetadata(dt,null,a)}}function pe(i,a,c){return{request:i,reply:a,routerCtx:c}}function he(i){let a=[];for(let y of i.params)switch(y.type){case"req":a.push("ctx.request");break;case"rep":a.push("ctx.reply");break;case"query":a.push(`ctx.request.query.${y.name}`);break;case"param":a.push(`ctx.request.params.${y.name}`);break;case"body":a.push("ctx.request.body");break;case"headers":a.push("ctx.request.headers");break;case"raw":a.push("ctx.request.raw");break;default:throw new Error(`No selector for "${JSON.stringify(y)}" found!`)}let c=`
  return function(fn, ctx) {
    return fn(${a.join(",")});
  }
  `;return new Function(c)()}async function pt(i){let a=new Map,c=[];for(let y of i){let m=await ye(y,a);c.push(m)}return c}async function ye(i,a){if(a.has(i))return a.get(i);let{deps:c}=Reflect.getMetadata(q,i)||[],y=await Promise.all(c.map(O=>ye(O,a))),m=new i(...y);return"onServiceInit"in m&&await m.onServiceInit(),a.set(i,m),m}async function $t(i,{controllers:a}){let c=await pt(a);for(let y of c){let{routerCtxs:m,rootPath:O}=Reflect.getMetadata("controller:config",y);for(let[,v]of m.entries()){let g=he(v),P=[O+v.path,v.opts?{...v.opts,schema:v.schema}:{schema:v.schema},async(R,k)=>{let C=pe(R,k,v);return g(y[v.propertyKey].bind(y),C)}];switch(v.method){case"GET":i.get(...P);break;case"DELETE":i.delete(...P);break;case"PATCH":i.patch(...P);break;case"POST":i.post(...P);break;case"PUT":i.put(...P);break;case"ALL":i.all(...P);break}}}}export{nt as All,at as Body,Je as Controller,tt as Delete,Ze as Get,ct as Headers,dt as INJECTABLE_SERVICE_SYMBOL,it as Parameter,rt as Patch,Ke as Post,et as Put,ot as Query,ft as Raw,ut as Rep,st as Req,lt as Schema,St as Service,$t as registerControllers};
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)
*/
//# sourceMappingURL=index.js.map